name: ðŸ”µ Superbid - DomÃ­nio Completo

on:
  # ExecuÃ§Ã£o manual
  workflow_dispatch:
  
  # Cron automÃ¡tico - DIA SIM, DIA NÃƒO (dias Ã­mpares)
  schedule:
    # Dias 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31 Ã s 5:30 UTC (2:30 BRT)
    - cron: '30 5 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31 * *'

jobs:
  superbid-scraper:
    name: ðŸ”µ Superbid - Scrape Completo
    runs-on: ubuntu-22.04
    timeout-minutes: 120
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install Dependencies
        run: |
          pip install requests==2.31.0 beautifulsoup4==4.12.3 python-dotenv==1.0.1
          pip install supabase==2.3.4 groq==0.9.0
      
      - name: Run Superbid Scraper (DomÃ­nio Completo)
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          PYTHONPATH: ${{ github.workspace }}/scrapers
        run: |
          echo "========================================"
          echo "ðŸ”µ SUPERBID - DOMÃNIO COMPLETO"
          echo "========================================"
          echo "ðŸ“… InÃ­cio: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ðŸ‡§ðŸ‡· HorÃ¡rio Brasil: $(TZ='America/Sao_Paulo' date '+%Y-%m-%d %H:%M:%S BRT')"
          echo "========================================"
          echo ""
          echo "ðŸ”¥ Varrendo TODAS as categorias do Superbid:"
          echo "   â€¢ VeÃ­culos (carros, motos, caminhÃµes, Ã´nibus, vans)"
          echo "   â€¢ ImÃ³veis"
          echo "   â€¢ Tecnologia"
          echo "   â€¢ EletrodomÃ©sticos"
          echo "   â€¢ Industrial e MÃ¡quinas"
          echo "   â€¢ Materiais de ConstruÃ§Ã£o"
          echo "   â€¢ E TODAS as outras categorias..."
          echo ""
          echo "========================================"
          
          cd scrapers/superbid
          python scraper.py
          
          echo ""
          echo "âœ… Superbid concluÃ­do: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
      
      - name: Upload Data (Debug)
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: superbid-${{ github.run_number }}
          path: scrapers/superbid/data/normalized/superbid_*.json
          retention-days: 3
      
      - name: Generate Summary
        if: always()
        run: |
          echo "## ðŸ”µ Superbid - DomÃ­nio Completo" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            echo "**Modo:** Manual" >> $GITHUB_STEP_SUMMARY
          else
            echo "**Modo:** Cron (automÃ¡tico dia sim/dia nÃ£o)" >> $GITHUB_STEP_SUMMARY
            echo "**FrequÃªncia:** Dias Ã­mpares (1,3,5,7...) Ã s 5:30 UTC (2:30 BRT)" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "**HorÃ¡rio UTC:** $(date -u '+%Y-%m-%d %H:%M')" >> $GITHUB_STEP_SUMMARY
          echo "**HorÃ¡rio Brasil:** $(TZ='America/Sao_Paulo' date '+%Y-%m-%d %H:%M')" >> $GITHUB_STEP_SUMMARY
          echo "**Run ID:** ${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¦ Categorias Processadas:" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… VeÃ­culos (5 subcategorias)" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ImÃ³veis" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Tecnologia" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… EletrodomÃ©sticos" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Industrial" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… MÃ¡quinas Pesadas" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Materiais de ConstruÃ§Ã£o" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Todas as outras (21 categorias no total)" >> $GITHUB_STEP_SUMMARY